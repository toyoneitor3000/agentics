<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PURPUR Agentic IDE</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;       /* Fondo principal muy oscuro */
            --bg-panel: #1e293b;      /* Paneles laterales */
            --bg-header: #334155;     /* Cabeceras de paneles */
            --primary: #8b5cf6;       /* Tu morado PURPUR */
            --primary-dim: #7c3aed;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --border: #475569;
            --console-bg: #000000;
            --success: #10b981;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; }

        /* --- LAYOUT GRID DE 3 COLUMNAS --- */
        .ide-container { display: grid; grid-template-columns: 260px 1fr 320px; width: 100%; height: 100%; }

        /* --- 1. SIDEBAR IZQUIERDO (Proyectos) --- */
        .sidebar { background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        
        .brand { padding: 15px; font-weight: 800; font-size: 1.2rem; color: var(--primary); letter-spacing: 1px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .brand i { font-size: 1.4rem; }

        .section-title { padding: 15px 15px 5px; font-size: 0.75rem; font-weight: bold; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }

        .project-list { flex: 1; overflow-y: auto; padding: 10px; }
        .project-item { padding: 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-dim); transition: 0.2s; font-size: 0.9rem; margin-bottom: 2px; }
        .project-item:hover { background: rgba(255,255,255,0.05); color: var(--text-main); }
        .project-item.active { background: rgba(139, 92, 246, 0.15); color: var(--primary); border-left: 3px solid var(--primary); }

        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .toolbox-title {
            color: #4CAF50;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* üìã SECCIONES DE HERRAMIENTAS */
        .tool-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #333;
            border-radius: 8px;
        }
        
        .tool-section h3 {
            color: #FFC107;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        /* üîÑ NODOS/AGENTES */
        .node-selector {
            background: #444;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .node-selector:hover {
            background: #555;
            transform: translateX(5px);
        }
        
        .node-selector.active {
            background: #4CAF50;
            border-left: 4px solid #8BC34A;
        }
        
        /* ‚öôÔ∏è CONTROLES DE MODELO */
        .model-control {
            margin: 10px 0;
        }
        
        .model-control label {
            display: block;
            margin-bottom: 5px;
            color: #81C784;
        }
        
        .model-control select,
        .model-control input,
        .model-control textarea {
            width: 100%;
            padding: 8px;
            background: #555;
            border: 1px solid #777;
            color: white;
            border-radius: 4px;
        }
        
        /* üõ†Ô∏è TOOL CALLS DISPONIBLES */
        .available-tools {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tool-item {
            background: #444;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tool-item:hover {
            background: #666;
            transform: scale(1.05);
        }
        
        .tool-item.selected {
            background: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }
        
        /* üí∞ PRECIO EN TIEMPO REAL */
        .price-tracker {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #4CAF50;
        }
        
        /* üì± CHAT PRINCIPAL */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .chat-header {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #2d2d2d;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .message {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            max-width: 70%;
        }
        
        .message.user {
            background: #2196F3;
            margin-left: auto;
        }
        
        .message.agent {
            background: #4CAF50;
        }
        
        .message-info {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
        }
        
        .input-area input {
            flex: 1;
            padding: 12px;
            background: #555;
            border: none;
            color: white;
            border-radius: 4px;
        }
        
        .input-area button {
            padding: 12px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* üï∏Ô∏è GRAFO VISUAL */
        .graph-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 200px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <!-- üß∞ PANEL DE HERRAMIENTAS -->
    <div class="toolbox-panel">
        <h2 class="toolbox-title">üß∞ CAJA DE HERRAMIENTAS</h2>
        
        <!-- üìä NODOS/AGENTES -->
        <div class="tool-section">
            <h3>ü§ñ NODOS AGENTES</h3>
            <div class="node-selector active" data-node="agent1" onclick="seleccionarNodo(this)">
                ü§ñ Agente 1 - Analizador
            </div>
            <div class="node-selector" data-node="agent2" onclick="seleccionarNodo(this)">
                üé® Agente 2 - Creador
            </div>
            <div class="node-selector" data-node="agent3" onclick="seleccionarNodo(this)">
                üîç Agente 3 - Revisor
            </div>
            <button onclick="agregarNodo()" style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px; margin-top: 10px; cursor: pointer;">
                ‚ûï Agregar Nodo
            </button>
        </div>
        
        <!-- ‚öôÔ∏è CONFIGURACI√ìN DEL MODELO -->
        <div class="tool-section">
            <h3>‚öôÔ∏è CONFIGURACI√ìN ACTUAL</h3>
            
            <div class="model-control">
                <label>ü§ñ Modelo:</label>
                <select id="modelo-select" onchange="cambiarModelo()">
                    <option value="llama-3.3-70b">ü¶ô Llama 3.3 70B</option>
                    <option value="claude-3-sonnet">üéØ Claude 3 Sonnet</option>
                    <option value="gpt-4-turbo">üß† GPT-4 Turbo</option>
                    <option value="gemini-pro">‚ôä Gemini Pro</option>
                </select>
            </div>
            
            <div class="model-control">
                <label>üìù Descripci√≥n:</label>
                <textarea id="descripcion-agente" rows="3" placeholder="Describe qu√© hace este agente...">Agente especializado en an√°lisis de c√≥digo y optimizaci√≥n</textarea>
            </div>
            
            <div class="model-control">
                <label>üå°Ô∏è Temperatura:</label>
                <input type="range" id="temperatura" min="0" max="2" step="0.1" value="0.7" onchange="actualizarTemperatura()">
                <span id="temp-valor">0.7</span>
            </div>
            
            <div class="model-control">
                <label>üéØ M√°x Tokens:</label>
                <input type="number" id="max-tokens" value="1000" min="100" max="8000" step="100">
            </div>
        </div>
        
        <!-- üõ†Ô∏è TOOLS DISPONIBLES -->
        <div class="tool-section">
            <h3>üîß TOOLS DISPONIBLES</h3>
            <div class="available-tools">
                <div class="tool-item" data-tool="code-generator" onclick="seleccionarTool(this)">
                    üíª Code Gen
                </div>
                <div class="tool-item" data-tool="image-analyzer" onclick="seleccionarTool(this)">
                    üì∏ Image AI
                </div>
                <div class="tool-item" data-tool="web-scraper" onclick="seleccionarTool(this)">
                    üï∏Ô∏è Web Scraping
                </div>
                <div class="tool-item" data-tool="calculator" onclick="seleccionarTool(this)">
                    üßÆ Calculator
                </div>
                <div class="tool-item" data-tool="file-reader" onclick="seleccionarTool(this)">
                    üìÑ File Reader
                </div>
                <div class="tool-item" data-tool="api-caller" onclick="seleccionarTool(this)">
                    üîó API Caller
                </div>
                <div class="tool-item" data-tool="database" onclick="seleccionarTool(this)">
                    üóÑÔ∏è Database
                </div>
                <div class="tool-item" data-tool="validator" onclick="seleccionarTool(this)">
                    ‚úÖ Validator
                </div>
                <div class="tool-item" data-tool="translator" onclick="seleccionarTool(this)">
                    üåê Translator
                </div>
                <div class="tool-item" data-tool="summarizer" onclick="seleccionarTool(this)">
                    üìã Summarizer
                </div>
                <div class="tool-item" data-tool="email-sender" onclick="seleccionarTool(this)">
                    üìß Email
                </div>
                <div class="tool-item" data-tool="weather" onclick="seleccionarTool(this)">
                    üå§Ô∏è Weather
                </div>
            </div>
            
            <button onclick="ejecutarToolSeleccionado()" style="width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 4px; margin-top: 10px; cursor: pointer;">
                ‚ñ∂Ô∏è Ejecutar Tool
            </button>
        </div>
        
        <!-- üìä INFO DEL NODO -->
        <div class="tool-section">
            <h3>üìä INFO ACTUAL</h3>
            <div style="font-size: 12px; line-height: 1.5;">
                <strong>Nodo:</strong> <span id="info-nodo">Agente 1</span><br>
                <strong>Modelo:</strong> <span id="info-modelo">Llama 3.3 70B</span><br>
                <strong>Tools:</strong> <span id="info-tools">Ninguno</span><br>
                <strong>Status:</strong> <span style="color: #4CAF50;">üü¢ Online</span>
            </div>
        </div>
    </div>
    
    <!-- üí∞ TRACKER DE PRECIOS -->
    <div class="price-tracker">
        <div style="font-size: 12px; color: #888;">COSTO ACTUAL</div>
        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;">
            $<span id="costo-total">0.00</span>
        </div>
        <div style="font-size: 11px; margin-top: 5px;">
            üí∞ $<span id="costo-mensaje">0.000</span> este mensaje<br>
            ‚ö° <span id="tokens-segundo">0</span> tok/s
        </div>
    </div>
    
    <!-- üí¨ CHAT PRINCIPAL -->
    <div class="chat-main">
        <div class="chat-header">
            <h2>ü§ñ CHAT CON AGENTES</h2>
            <div>
                <span id="estado-conexion" style="color: #4CAF50;">‚óè Conectado</span>
                <button onclick="toggleToolbox()" style="margin-left: 10px; padding: 5px 10px; background: #555; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    üß∞ Tools
                </button>
            </div>
        </div>
        
        <div class="chat-messages" id="mensajes-chat">
            <div class="message agent">
                <div>ü§ñ ¬°Hola! Soy tu agente configurado con herramientas. ¬øQu√© necesitas?</div>
                <div class="message-info">üí∞ $0.00 | üìù 0‚Üí12 tokens | 0.1s | Llama 3.3 70B</div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="input-mensaje" placeholder="Escribe tu mensaje o @menciona un tool...">
            <input type="file" id="input-archivo" accept="image/*,.pdf,.txt" style="width: auto;">
            <button onclick="enviarMensaje()">Enviar</button>
        </div>
    </div>
    
    <!-- üï∏Ô∏è GRAFO VISUAL -->
    <div class="graph-container">
        <div style="text-align: center; margin-bottom: 10px; font-size: 12px;">üï∏Ô∏è FLUJO ACTUAL</div>
        <canvas id="grafo-canvas" width="280" height="120"></canvas>
    </div>

    <script>
        // üß† VARIABLES GLOBALES
        let nodoActual = 'agent1';
        let modeloActual = 'llama-3.3-70b';
        let toolsSeleccionados = [];
        let costoTotal = 0;
        
        // üîß FUNCIONES DE LA CAJA DE HERRAMIENTAS
        function seleccionarNodo(elemento) {
            // Quita selecci√≥n previa
            document.querySelectorAll('.node-selector').forEach(n => n.classList.remove('active'));
            // Selecciona nuevo
            elemento.classList.add('active');
            nodoActual = elemento.dataset.node;
            
            // Actualiza info
            document.getElementById('info-nodo').textContent = elemento.textContent.trim();
            actualizarGrafo();
        }
        
        function cambiarModelo() {
            modeloActual = document.getElementById('modelo-select').value;
            document.getElementById('info-modelo').textContent = 
                document.getElementById('modelo-select').options[document.getElementById('modelo-select').selectedIndex].text;
        }
        
        function actualizarTemperatura() {
            document.getElementById('temp-valor').textContent = 
                document.getElementById('temperatura').value;
        }
        
        function seleccionarTool(elemento) {
            elemento.classList.toggle('selected');
            const tool = elemento.dataset.tool;
            
            if (toolsSeleccionados.includes(tool)) {
                toolsSeleccionados = toolsSeleccionados.filter(t => t !== tool);
            } else {
                toolsSeleccionados.push(tool);
            }
            
            document.getElementById('info-tools').textContent = 
                toolsSeleccionados.length > 0 ? toolsSeleccionados.join(', ') : 'Ninguno';
        }
        
        function ejecutarToolSeleccionado() {
            if (toolsSeleccionados.length === 0) {
                alert('‚ö†Ô∏è Selecciona al menos una herramienta');
                return;
            }
            
            const mensaje = `Ejecutando tools: ${toolsSeleccionados.join(', ')}`;
            agregarMensajeAlChat('agent', mensaje);
        }
        
        function agregarNodo() {
            const nombre = prompt('Nombre del nuevo nodo:');
            if (nombre) {
                const nuevoNodo = document.createElement('div');
                nuevoNodo.className = 'node-selector';
                nuevoNodo.dataset.node = 'agent' + Date.now();
                nuevoNodo.innerHTML = `ü§ñ ${nombre}`;
                nuevoNodo.onclick = function() { seleccionarNodo(this); };
                document.querySelector('.tool-section').appendChild(nuevoNodo);
            }
        }
        
        function toggleToolbox() {
            const panel = document.querySelector('.toolbox-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        // üí¨ FUNCIONES DEL CHAT
        function enviarMensaje() {
            const input = document.getElementById('input-mensaje');
            const mensaje = input.value;
            if (!mensaje) return;
            
            // Agrega mensaje del usuario
            agregarMensajeAlChat('user', mensaje);
            
            // Procesa con el agente actual
            procesarConAgente(mensaje);
            
            input.value = '';
        }
        
        function agregarMensajeAlChat(tipo, texto) {
            const mensajesDiv = document.getElementById('mensajes-chat');
            const mensajeDiv = document.createElement('div');
            mensajeDiv.className = `message ${tipo}`;
            
            // Calcula costo aproximado
            const tokensEntrada = tipo === 'user' ? texto.split(' ').length * 1.3 : 0;
            const tokensSalida = tipo === 'agent' ? texto.split(' ').length * 1.3 : 0;
            const costoMensaje = (tokensEntrada * 0.001) + (tokensSalida * 0.003);
            costoTotal += costoMensaje;
            
            mensajeDiv.innerHTML = `
                <div>${texto}</div>
                <div class="message-info">
                    üí∞ $${costoMensaje.toFixed(4)} | 
                    üìù ${Math.round(tokensEntrada)}‚Üí${Math.round(tokensSalida)} | 
                    ‚ö° 1.2s | 
                    ${modeloActual.toUpperCase()}
                </div>
            `;
            
            mensajesDiv.appendChild(mensajeDiv);
            mensajesDiv.scrollTop = mensajesDiv.scrollHeight;
            
            // Actualiza precio
            document.getElementById('costo-total').textContent = costoTotal.toFixed(4);
            document.getElementById('costo-mensaje').textContent = costoMensaje.toFixed(4);
            document.getElementById('tokens-segundo').textContent = Math.round(tokensSalida / 1.2);
        }
        
        function procesarConAgente(mensaje) {
            // Simula procesamiento
            setTimeout(() => {
                let respuesta = '';
                
                // Seg√∫n el nodo actual y tools seleccionados
                if (toolsSeleccionados.includes('code-generator')) {
                    respuesta = `ü§ñ [${nodoActual.toUpperCase()}] Generando c√≥digo para: "${mensaje}"`;
                } else if (toolsSeleccionados.includes('image-analyzer')) {
                    respuesta = `üñºÔ∏è [${nodoActual.toUpperCase()}] Analizando imagen: "${mensaje}"`;
                } else {
                    respuesta = `ü§ñ [${nodoActual.toUpperCase()}] Procesando: "${mensaje}"`;
                }
                
                agregarMensajeAlChat('agent', respuesta);
                actualizarGrafo();
            }, 1000);
        }
        
        // üï∏Ô∏è GRAFO VISUAL
        function actualizarGrafo() {
            const canvas = document.getElementById('grafo-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dibuja nodos
            const nodos = [
                { x: 50, y: 60, label: 'T√∫', color: '#4CAF50' },
                { x: 140, y: 60, label: nodoActual, color: '#2196F3' },
                { x: 230, y: 60, label: 'Output', color: '#FF9800' }
            ];
            
            // Dibuja l√≠neas con animaci√≥n
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < nodos.length - 1; i++) {
                ctx.beginPath();
                ctx.moveTo(nodos[i].x + 30, nodos[i].y);
                ctx.lineTo(nodos[i + 1].x - 30, nodos[i + 1].y);
                ctx.stroke();
                
                // Flecha
                ctx.beginPath();
                ctx.moveTo(nodos[i + 1].x - 30, nodos[i + 1].y);
                ctx.lineTo(nodos[i + 1].x - 35, nodos[i + 1].y - 5);
                ctx.lineTo(nodos[i + 1].x - 35, nodos[i + 1].y + 5);
                ctx.fillStyle = '#666';
                ctx.fill();
            }
            
            // Dibuja nodos
            nodos.forEach(nodo => {
                ctx.fillStyle = nodo.color;
                ctx.fillRect(nodo.x - 30, nodo.y - 15, 60, 30);
                
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(nodo.label, nodo.x, nodo.y + 3);
            });
        }
        
        // üöÄ INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            actualizarGrafo();
            
            // Enter para enviar
            document.getElementById('input-mensaje').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') enviarMensaje();
            });
        });
    </script>
</body>
</html>
